//devin87@qq.com
//build:2017/02/10 11:19:02
!function(e,t){"use strict";var n=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=Q.Uploader;i.extend({_upload_slice:function(e){var t,o=this,a=e.blob||e.file,r=a.size,s=o.chunkSize,c=e.sliceStart||0,l=function(n,a){var s=new XMLHttpRequest,l=e.url,d=t==r;e.xhr=s,l+=(-1==l.indexOf("?")?"?":"&")+"action=upload&hash="+(e.hash||e.name)+"&ok="+(d?"1":"0"),s.upload.addEventListener("progress",function(t){o.progress(e,r,c+t.loaded)},!1),s.addEventListener("load",function(t){d&&o.complete(e,i.COMPLETE,t.target.responseText),a()},!1),s.addEventListener("error",function(){o.complete(e,i.ERROR)},!1);var p=new FormData;d&&(o._process_params(e,function(e,t){p.append(e,t)}),p.append("fileName",e.name)),p.append(o.upName,n,e.name),s.open("POST",l),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),d?o.fire("send",e,function(t){return t===!1?o.complete(e,i.SKIP):void s.send(p)}):s.send(p)};e.sliceCount=Math.ceil(r/s);var d=function(){c>=r||(t=c+s,t>r&&(t=r),e.sliceStart=c,e.sliceEnd=t,e.sliceIndex=Math.ceil(t/s),o.fire("sliceUpload",e,function(e){if(e===!1)return p();var i=n.call(a,c,t);l(i,p)}))},p=function(){c=t,d()};d(),o._afterSend(e)}})}(window);